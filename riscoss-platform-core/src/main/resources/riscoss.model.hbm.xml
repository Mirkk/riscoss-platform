<!DOCTYPE hibernate-mapping PUBLIC
    "-//Hibernate/Hibernate Mapping DTD//EN"
    "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">
<hibernate-mapping>
  <class name="eu.riscoss.api.model.Scope" table="SCOPES">
    <id name="id" column="SCOPE_ID"/>
    <property name="name"/>
    <property name="description"/>

    <joined-subclass name="eu.riscoss.api.model.Company" table="COMPANIES">
      <key column="COMPANY_ID"/>
      <set name="products" cascade="save-update" inverse="true">
        <!-- This must match the foreign key column name in the Products many-to-one mapping -->
        <key column="COMPANY_ID"/>
        <one-to-many class="eu.riscoss.api.model.Product"/>
      </set>
    </joined-subclass>

    <joined-subclass name="eu.riscoss.api.model.Project">
      <key column="PROJECT_ID"/>
    </joined-subclass>

    <joined-subclass name="eu.riscoss.api.model.Product" table="PRODUCTS">
      <key column="PRODUCT_ID"/>
      <!-- Foreign key for associated company-->
      <many-to-one name="company" class="eu.riscoss.api.model.Company" column="COMPANY_ID"/>

      <set name="components" cascade="save-update">
        <key column="PRODUCT_ID"/>
        <one-to-many class="eu.riscoss.api.model.Component"/>
      </set>
    </joined-subclass>

    <joined-subclass name="eu.riscoss.api.model.Component" table="COMPONENTS">
      <key column="COMPONENT_ID"/>
      <property name="version"/>

      <joined-subclass name="eu.riscoss.api.model.OSSComponent" table="OSSCOMPONENTS">
        <key column="OSSCOMPONENT_ID"/>
        <property name="webSite"/>
        <many-to-one name="ossCommunity" class="eu.riscoss.api.model.OSSCommunity" column="OSSCOMMUNITY_ID"/>
      </joined-subclass>
    </joined-subclass>
  </class>

  <class name="eu.riscoss.api.model.OSSCommunity" table="OSSCOMMUNITIES">
    <id name="id" column="OSSCOMMUNITY_ID"/>
    <set name="components">
      <key column="OSSCOMMUNITY_ID"/>
      <one-to-many class="eu.riscoss.api.model.OSSComponent"/>
    </set>
  </class>

  <class name="eu.riscoss.api.model.Measurement" table="MEASUREMENTS">
    <id name="id" column="MEASUREMENT_ID">
      <generator class="native"/>
    </id>
    <many-to-one name="scope" class="eu.riscoss.api.model.Scope" column="SCOPE_ID"/>
    <property name="type" not-null="true" column="MEASUREMENT_TYPE"/>
    <property name="date" type="timestamp" not-null="true" column="MEASUREMENT_DATE"/>
    <property name="value" type="text" not-null="true" column="MEASUREMENT_VALUE"/>
  </class>

  <class name="eu.riscoss.api.model.Indicator" table="INDICATORS">
    <composite-id>
      <key-property name="type" column="INDICATOR_TYPE"/>
      <key-many-to-one name="scope" class="eu.riscoss.api.model.Scope" column="SCOPE_ID"/>
    </composite-id>
    <property name="date" type="timestamp" not-null="true" column="INDICATOR_DATE"/>
    <property name="value" type="text" not-null="true" column="INDICATOR_VALUE"/>
  </class>

  <class name="eu.riscoss.api.model.RiskModel" table="RISKMODELS">
    <id name="id"/>
    <property name="xml" type="text" not-null="true"/>
  </class>

  <class name="eu.riscoss.api.model.GoalModel" table="GOALMODELS">
    <id name="id"/>
    <property name="xml" type="text" not-null="true"/>
  </class>

  <class name="eu.riscoss.api.model.ImpactModel" table="IMPACTMODELS">
    <id name="id"/>
    <property name="xml" type="text" not-null="true"/>
  </class>

  <class name="eu.riscoss.api.model.questionnaire.Question" table="QUESTIONS">
    <id name="id"/>
    <property name="type">
      <type name="org.hibernate.type.EnumType">
        <param name="enumClass">eu.riscoss.api.model.questionnaire.Question$Type</param>
      </type>
    </property>
    <property name="question"/>
    <property name="help"/>
    <property name="possibleAnswersRaw" type="text"/>
    <property name="mandatory"/>
  </class>

  <class name="eu.riscoss.internal.AnswerWithScope" table="ANSWERS">
    <composite-id>
      <key-property name="questionId"/>
      <key-many-to-one name="scope"/>
    </composite-id>
    <property name="values" column="answerValues" type="text"/>
  </class>


</hibernate-mapping>